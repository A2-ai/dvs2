[package]
name = "dvs-core"
description = """
Core library for DVS (Data Version System).

Provides content-addressable storage with blake3 hashing for versioning large
or sensitive files under Git. This crate contains:
- Types: Config, Metadata, FileInfo, error types
- Operations: init, add, get, status
- Helpers: hashing, file copying, config loading, glob expansion
"""
publish = false
version = "0.0.0-9000"
authors = []
license = "MIT"
edition = "2021"
rust-version = "1.86"

[lib]
path = "src/lib.rs"

[features]
default = ["blake3", "mmap", "walkdir", "toml-config", "serde"]
blake3 = ["dep:blake3"]
xxh3 = ["dep:xxhash-rust"]
sha256 = ["dep:sha2"]
all-hashes = ["blake3", "xxh3", "sha256"]
mmap = ["dep:memmap2"]
walkdir = ["dep:walkdir"]
# Serialization (required for config/metadata/manifest persistence)
serde = ["dep:serde", "dep:serde_json"]
# Config format (mutually exclusive, yaml-config takes precedence)
yaml-config = ["serde", "dep:serde_yaml"]
toml-config = ["serde", "dep:toml"]

[dependencies]
# Serialization (optional)
serde = { version = "1", features = ["derive"], optional = true }
serde_yaml = { version = "0.9", optional = true }
serde_json = { version = "1", optional = true }
toml = { version = "0.9", optional = true }

# Hashing (mmap is optional optimization)
memmap2 = { version = "0.9", optional = true }

# Hash algorithms (optional features)
blake3 = { version = "1.8", features = ["rayon"], optional = true }
xxhash-rust = { version = "0.8", features = ["xxh3"], optional = true }
sha2 = { version = "0.10", optional = true }

# File system
fs-err = "2"
walkdir = { version = "2.5", optional = true }
glob = "0.3"

# Utilities
jiff = { version = "0.2", features = ["serde"] }
file-owner = "0.1.2"
path-absolutize = "3.1.1"
xdg = "3.0.0"
pathdiff = "0.2.3"
libc = "0.2"

# User info
whoami = "2.0.2"

# Error handling
exn = "0.2.1"

[dev-dependencies]
tempfile = "3.24.0"
